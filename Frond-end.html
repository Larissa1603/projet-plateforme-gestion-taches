<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Plateforme – Application complète</title>

  <!-- CSS UNIQUE -->
  <link rel="stylesheet" href="styles.css">

  <style>
    /* Système interne pour afficher/cacher une page */
    .page { display: none; }
    .active-page { display: block; }
  </style>
</head>
<body>


<!-- EN-TÊTE GLOBAL  -->

<header class="site-header">
  <h1 class="logo">Plateforme</h1>

  <nav>
    <a href="#" onclick="showPage('dashboard')">Dashboard</a>
    <a href="#" onclick="showPage('projects')">Projets</a>
    <a href="#" onclick="showPage('tasks')">Tâches</a>
    <a href="#" onclick="showPage('users')">Utilisateurs</a>
    <a href="#" onclick="showPage('signup')">S'inscrire</a>
    <a href="#" onclick="showPage('login')">Se connecter</a>
  </nav>

  <div class="auth" id="auth-block"></div>
</header>


<!-- DASHBOARD  -->

<div id="dashboard" class="page active-page container">
  <section class="card">
    <h2>Tableau de bord</h2>
    <p>Bienvenue sur ta plateforme de gestion.</p>
    <div id="summary"></div>
  </section>
</div>



<!-- LOGIN -->

<div id="login" class="page container center">
  <form class="card form" id="loginForm">
    <h2>Connexion</h2>
    <div id="loginError" class="error" style="display:none"></div>

    <label>Email
      <input type="email" id="loginEmail" required>
    </label>

    <label>Mot de passe
      <input type="password" id="loginPassword" required minlength="6">
    </label>

    <button type="submit">Se connecter</button>
  </form>
</div>


<!--  SIGNUP  -->

<div id="signup" class="page container center">
  <form class="card form" id="signupForm">
    <h2>Créer un compte</h2>
    <div id="signupError" class="error" style="display:none"></div>

    <label>Email
      <input type="email" id="signupEmail" required>
    </label>

    <label>Mot de passe
      <input type="password" id="signupPassword" required minlength="6">
    </label>

    <label>Confirmer
      <input type="password" id="signupPassword2" required minlength="6">
    </label>

    <button type="submit">Créer un compte</button>
  </form>
</div>


<!-- PROJETS  -->

<div id="projects" class="page container">
  <div class="toolbar">
    <h2>Projets</h2>
    <button class="btn" id="btnShowCreateProject">+ Nouveau projet</button>
  </div>

  <section id="projectCreate" class="card" style="display:none">
    <h3>Nouveau projet</h3>
    <form id="projectForm">
      <label>Nom<input id="proj-name" required></label>
      <label>Description<textarea id="proj-desc"></textarea></label>
      <label>Début<input type="date" id="proj-start"></label>
      <label>Fin<input type="date" id="proj-end"></label>
      <button type="submit">Créer</button>
      <button type="button" id="cancelProject">Annuler</button>
    </form>
  </section>

  <section id="projectList" class="grid"></section>
  <div id="projectPagination" class="muted"></div>
</div>


<!-- TÂCHES  -->

<div id="tasks" class="page container">
  <div class="toolbar">
    <h2>Tâches</h2>
    <button class="btn" id="btnShowCreateTask">+ Nouvelle tâche</button>
  </div>

  <section id="taskCreate" class="card" style="display:none">
    <h3>Créer une tâche</h3>
    <form id="taskForm">
      <label>Titre<input id="task-title" required></label>
      <label>Description<textarea id="task-desc"></textarea></label>
      <label>Projet<select id="task-project"><option>Chargement...</option></select></label>
      <button type="submit">Créer</button>
      <button type="button" id="cancelTask">Annuler</button>
    </form>
  </section>

  <section id="taskList" class="list"></section>
</div>



<!-- UTILISATEURS -->

<div id="users" class="page container">
  <h2>Utilisateurs</h2>
  <div id="usersList" class="list"></div>
</div>




<!--Javascripts--> 

<script src="app.js"></script>

<script>

  // SYSTÈME DE NAVIGATION INTERNE 
  function showPage(id) {
    document.querySelectorAll('.page').forEach(p => p.classList.remove('active-page'));
    document.getElementById(id).classList.add('active-page');
    window.scrollTo(0,0);
  }



  // SIGNUP 
  document.getElementById('signupForm')?.addEventListener('submit', async (e)=>{
    e.preventDefault();
    const email = signupEmail.value.trim();
    const pass1 = signupPassword.value;
    const pass2 = signupPassword2.value;

    if(pass1 !== pass2){
      signupError.style.display="block";
      signupError.textContent="Les mots de passe ne correspondent pas.";
      return;
    }

    try{
      const res = await apiPost('/auth/register',{email,password:pass1});
      localStorage.setItem('token', res.token);
      showPage('dashboard');
    }catch(err){
      signupError.style.display="block";
      signupError.textContent=err.message || "Erreur d'inscription";
    }
  });



  // LOGIN 
  document.getElementById('loginForm')?.addEventListener('submit', async(e)=>{
    e.preventDefault();
    const email = loginEmail.value.trim();
    const password = loginPassword.value;

    try{
      const res = await apiPost('/users/login',{email,mot_de_passe:password});
      localStorage.setItem('token',res.token);
      showPage('dashboard');
    }catch(err){
      loginError.style.display="block";
      loginError.textContent=err.message || "Erreur de connexion";
    }
  });



  //PROJETS 
  document.getElementById('btnShowCreateProject').onclick = ()=> projectCreate.style.display="block";
  document.getElementById('cancelProject').onclick = ()=> projectCreate.style.display="none";


  // TÂCHES 
  document.getElementById('btnShowCreateTask').onclick = ()=> taskCreate.style.display="block";
  document.getElementById('cancelTask').onclick = ()=> taskCreate.style.display="none";

</script>

</body>
</html>
